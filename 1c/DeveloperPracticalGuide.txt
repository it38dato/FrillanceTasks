//Разработка базы данных Практическое пособие разработчика
&НаКлиенте
Процедура ТоварыЦенаПриИзменении(Элемент)
  Стр=Элементы.Товары.ТекущиеДанные;
  РасчетСтроки(Стр);
  //Стр=Элементы.Товары.ТекущиеДанные;
  //ПроцедурыДокументов.РассчетСтроки(Стр);
КонецПроцедуры
&НаКлиенте
Процедура ТоварыКоличествоПриИзменении(Элемент)
  Стр=Элементы.Товары.ТекущиеДанные;
  РасчетСтроки(Стр);
  //Стр=Элементы.Товары.Стр;
  //ПроцедурыДокументов.РассчетСтроки(Стр);
КонецПроцедуры
&НаКлиенте
Процедура РасчетСтроки(ТекСтр)
  ТекСтр.Сумма=ТекСтр.Цена*ТекСтр.Количество;
КонецПроцедуры
&НаКлиенте
Процедура ТоварыСуммаПриИзменении(Элемент)
  Стр=Элементы.Товары.ТекущиеДанные;
  Если Стр.Количество = 0 Тогда
    Сообщить("Ошибка");
  Иначе
    Стр.Цена=Стр.Сумма/Стр.Количество;
  КонецЕсли
КонецПроцедуры
&НаКлиенте
Процедура ТоварыНоменклатураПриИзменении(Элемент)
  Стр=Элементы.Товары.ТекущиеДанные;
  Стр.Цена=ПолучитьЦену(Стр.Номенклатура);
  РасчетСтроки(Стр);
КонецПроцедуры
&НаСервереБезКонтекста
Функция ПолучитьЦену(Товар)
  //Возврат Товар.Цена;  //{{КОНСТРУКТОР_ЗАПРОСА_С_ОБРАБОТКОЙ_РЕЗУЛЬТАТА
  // Данный фрагмент построен конструктором.
  // При повторном использовании конструктора, внесенные вручную изменения будут утеряны!!!    
  Запрос = Новый Запрос;
  Запрос.Текст =
    "ВЫБРАТЬ
    |  Номенклатура.Цена
    |ИЗ
    |  Справочник.Номенклатура КАК Номенклатура
    |ГДЕ
    |  Номенклатура.Ссылка = &Ссылка";      
  Запрос.УстановитьПараметр("Ссылка", Товар);      
  РезультатЗапроса = Запрос.Выполнить();        
  ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();    
  Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
    // Вставить обработку выборки ВыборкаДетальныеЗаписи
  КонецЦикла;                        
  //}}КОНСТРУКТОР_ЗАПРОСА_С_ОБРАБОТКОЙ_РЕЗУЛЬТАТА
КонецФункции
&НаКлиенте
Процедура Сделать(Команда)
  Для каждого Стр Из Объект.Товары Цикл
    Стр.Цена=ПолучитьЦену(Стр.Номенклатура);
    РасчетСтроки(Стр);
  КонецЦикла;
КонецПроцедуры