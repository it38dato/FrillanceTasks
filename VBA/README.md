<p>Services:<br># Interview<br># Разработка макросов в VBA.<br><strong>Task:</strong><br>Объект Model в Excel<br># Interview.<br><strong>Decision:</strong><br>обеспечивает основу для загрузки и объединения исходных данных из нескольких источников данных для анализа данных на рабочем столе, включая реляционные базы данных, многомерные источники, облачные службы, веб-каналы данных, файлы Excel, текстовые файлы и данные из Интернета. Excel интегрирует дополнительные источники данных и позволяет объединять данные из нескольких источников данных.<br>предназначена для программного создания связей между таблицами модели, в результате чего создаются объединенные таблицы, объединение сводных таблиц и т. д.<br><strong>Task:</strong><br>Пробежаться по всем ячейкам выделенной области и для каждой ячейки аменять формулу на начение.<br># Разработка макросов в VBA.<br><strong>Decision:</strong><br>- Файл - Параметры - Настроить ленту - Выбрать команды - ОСновные вкладки - Раработчик - Добавить - Ок<br>- Раработчик - Visual Basic - Insert - Module<br>Sub Аменитель()<br>For Each cell In Selection<br>cell.Formula = cell.Value<br>Next cell<br>MsgBox "Я все сделал!"<br>End Sub<br>- Save - *.xlsm - выделяем ячейки - Макросы - аменитель - Выполнить<br><strong>Task:</strong><br>Рассчитать сумму НДС<br># Разработка макросов в VBA.<br><strong>Decision:</strong><br>...<br>Function NDS(Summa)<br>&nbsp;&nbsp;NDS = Summa * 0.13<br>End Function<br>- сохранить - Вставить функцию - Категория - Определенные польователем - NDS - ок<br><strong>Source:</strong><br># https://www.planetaexcel.ru/techniques/3/59/ - Создание макросов и пользовательских функций на VBA.<br># https://learn.microsoft.com/ru-ru/office/vba/api/overview/ - Справочник по VBA для Excel.<br># https://habr.com/ru/articles/112080/ - Автоматизация рутины в Microsoft Excel при помощи VBA.<br><strong>Task:</strong><br>Создать макрос в Excel, который будет автоматически проверять данные на упаковке, используя API OpenAI, и формировать отчет с результатами проверки.<br>Структура и описание работы макроса<br>1. Подбор файлов:<br># Макрос запускается вручную пользователем.<br># Пользователь указывает папку с файлами макетов через проводник.<br># Для выбора папки с макетами на первой странице создается кнопка "Выбрать папку".<br># По нажатию на кнопку открывается проводник для выбора папки с макетами.<br># Макрос ищет файлы PDF для каждой строки в таблице, где имя файла начинается со значения в столбце "EAN" и заканчивается на "notforprint.pdf".<br># Ссылки на найденные файлы выводятся в отдельный столбец.<br># Если файл не найден, соответствующая ячейка окрашивается в красный цвет.<br>2. Создание страницы PARAM:<br># Макрос создает вторую страницу в файле Excel под названием PARAM.<br># На этой странице создаются параметры:<br>system (значение по умолчанию: "gpt-4o-mini")<br>user (значение по умолчанию: "контекст")<br>model (значение по умолчанию: "запрос")<br>API_KEY (значение по умолчанию: "a16z")<br>3. Проверка данных:<br># На первой странице создается кнопка "Проверить".<br># При нажатии на кнопку формируется JSON для каждой строки, который состоит из названия столбцов и параметров в каждом столбце.<br># Файл по ссылке кодируется в base64.<br># Отправляется запрос на API OpenAI с параметрами:<br>model (берется со страницы PARAM)<br>system (берется со страницы PARAM)<br>user (значение из страницы PARAM + конкатенация JSON)<br>API_KEY (берется со страницы PARAM)<br>Обязательное указание response_format={"type": "json_object"}<br># Результат запроса (JSON) распарсивается и добавляется в таблицу как новые столбцы.<br># Лог выполнения и результаты каждого шага записываются на новую страницу LOG.<br>4. Условное форматирование:<br>o После завершения обработки всех строк, добавить условное форматирование.<br>o Выделить красным те ячейки в новых столбцах, которые не соответствуют начальным значениям.<br>Требования к реализации<br>1. Обработка ошибок:<br>o Макрос должен корректно обрабатывать случаи, когда API возвращает ошибку или некорректные данные.<br>o При возникновении ошибки отображать сообщение пользователю и продолжать выполнение для следующих строк.<br># Разработка макросов в VBA.<br><strong>Decision:</strong><br>- Module1<br>Function GetFolderPath(Optional ByVal Title As String = "Выберите папку", _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Optional ByVal InitialPath As String = "c:\") As String<br>&nbsp;&nbsp;' функция выводит диалоговое окно выбора папки с заголовком Title,<br>&nbsp;&nbsp;' начиная обзор диска с папки InitialPath<br>&nbsp;&nbsp;' возвращает полный путь к выбранной папке, или пустую строку в случае отказа от выбора<br>&nbsp;&nbsp;Dim PS As String: PS = Application.PathSeparator<br>&nbsp;&nbsp;With Application.FileDialog(msoFileDialogFolderPicker)<br>&nbsp;&nbsp;&nbsp;&nbsp;If Not Right$(InitialPath, 1) = PS Then InitialPath = InitialPath & PS<br>&nbsp;&nbsp;&nbsp;&nbsp;.ButtonName = "Выбрать": .Title = Title: .InitialFileName = InitialPath<br>&nbsp;&nbsp;&nbsp;&nbsp;If .Show &lt;&gt; -1 Then Exit Function<br>&nbsp;&nbsp;&nbsp;&nbsp;GetFolderPath = .SelectedItems(1)<br>&nbsp;&nbsp;&nbsp;&nbsp;If Not Right$(GetFolderPath, 1) = PS Then GetFolderPath = GetFolderPath & PS<br>&nbsp;&nbsp;End With<br>End Function<br>- Лист 1<br>Sub ПримерИспользования_GetFolderPath()<br>&nbsp;&nbsp;ПутьКПапке = GetFolderPath("Заголовок окна", ThisWorkbook.Path)   ' запрашиваем имя папки<br>&nbsp;&nbsp;If ПутьКПапке = "" Then Exit Sub&nbsp;&nbsp;' выход, если пользователь отказался от выбора папки<br>&nbsp;&nbsp;MsgBox "Выбрана папка: " & ПутьКПапке, vbInformation<br>End Sub<br>- Лист 1<br>Sub CommandButton1_Click()<br>&nbsp;&nbsp;Dim V As String<br>&nbsp;&nbsp;Dim BrowseFolder As String<br>&nbsp;&nbsp;'открываем диалоговое окно выбора папки<br>&nbsp;&nbsp;With Application.FileDialog(msoFileDialogFolderPicker)<br>&nbsp;&nbsp;&nbsp;&nbsp;.Title = "Выберите папку или диск"<br>&nbsp;&nbsp;&nbsp;&nbsp;.Show<br>&nbsp;&nbsp;&nbsp;&nbsp;On Error Resume Next<br>&nbsp;&nbsp;&nbsp;&nbsp;Err.Clear<br>&nbsp;&nbsp;&nbsp;&nbsp;V = .SelectedItems(1)<br>&nbsp;&nbsp;&nbsp;&nbsp;If Err.Number &lt;&gt; 0 Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MsgBox "Вы ничего не выбрали!"<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Exit Sub<br>&nbsp;&nbsp;&nbsp;&nbsp;End If<br>&nbsp;&nbsp;End With<br>&nbsp;&nbsp;BrowseFolder = CStr(V)<br>&nbsp;&nbsp;'добавляем лист и выводим на него шапку таблицы<br>&nbsp;&nbsp;'ActiveWorkbook.Sheets.Add<br>&nbsp;&nbsp;With Range("A1:E1")<br>&nbsp;&nbsp;&nbsp;&nbsp;.Font.Bold = True<br>&nbsp;&nbsp;&nbsp;&nbsp;.Font.Size = 12<br>&nbsp;&nbsp;End With<br>&nbsp;&nbsp;Range("A1").Value = "Имя файла"<br>&nbsp;&nbsp;'Range("B1").Value = "Путь"<br>&nbsp;&nbsp;Range("B1").Value = "Размер"<br>&nbsp;&nbsp;'Range("D1").Value = "Дата создания"<br>&nbsp;&nbsp;'Range("E1").Value = "Дата изменения"<br>&nbsp;&nbsp;'вызываем процедуру вывода списка файлов<br>&nbsp;&nbsp;'измените True на False, если не нужно выводить файлы из вложенных папок<br>&nbsp;&nbsp;ListFilesInFolder BrowseFolder, True<br>End Sub<br>Private Sub ListFilesInFolder(ByVal SourceFolderName As String, ByVal IncludeSubfolders As Boolean)<br>&nbsp;&nbsp;Dim FSO As Object<br>&nbsp;&nbsp;Dim SourceFolder As Object<br>&nbsp;&nbsp;Dim SubFolder As Object<br>&nbsp;&nbsp;Dim FileItem As Object<br>&nbsp;&nbsp;Dim r As Long<br>&nbsp;&nbsp;Set FSO = CreateObject("Scripting.FileSystemObject")<br>&nbsp;&nbsp;Set SourceFolder = FSO.getfolder(SourceFolderName)<br>&nbsp;&nbsp;r = Range("A65536").End(xlUp).Row + 1 'Находм первую пустую строку<br>&nbsp;&nbsp;'Выводим данные по файлу<br>&nbsp;&nbsp;For Each FileItem In SourceFolder.Files<br>&nbsp;&nbsp;&nbsp;&nbsp;Cells(r, 1).Formula = FileItem.Name<br>&nbsp;&nbsp;&nbsp;&nbsp;'Cells(r, 2).Formula = FileItem.Path<br>&nbsp;&nbsp;&nbsp;&nbsp;Cells(r, 2).Formula = FileItem.Size<br>&nbsp;&nbsp;&nbsp;&nbsp;'Cells(r, 4).Formula = FileItem.DateCreated<br>&nbsp;&nbsp;&nbsp;&nbsp;'Cells(r, 5).Formula = FileItem.DateLastModified<br>&nbsp;&nbsp;&nbsp;&nbsp;r = r + 1<br>&nbsp;&nbsp;&nbsp;&nbsp;X = SourceFolder.Path<br>&nbsp;&nbsp;Next FileItem<br>&nbsp;&nbsp;'Вызываем процедуру повторно для каждой вложенной папки<br>&nbsp;&nbsp;If IncludeSubfolders Then<br>&nbsp;&nbsp;&nbsp;&nbsp;For Each SubFolder In SourceFolder.SubFolders<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ListFilesInFolder SubFolder.Path, True<br>&nbsp;&nbsp;&nbsp;&nbsp;Next SubFolder<br>&nbsp;&nbsp;End If<br>&nbsp;&nbsp;Columns("A:B").AutoFit<br>&nbsp;&nbsp;Set FileItem = Nothing<br>&nbsp;&nbsp;Set SourceFolder = Nothing<br>&nbsp;&nbsp;Set FSO = Nothing<br>End Sub<br>- Лист 1<br>...<br>&nbsp;&nbsp;For Each FileItem In SourceFolder.Files<br>&nbsp;&nbsp;&nbsp;&nbsp;'MsgBox FileItem<br>&nbsp;&nbsp;&nbsp;&nbsp;'pdfFiles = Application.GetOpenFilename("PDF Files (*.pdf), *.pdf")<br>&nbsp;&nbsp;&nbsp;&nbsp;If FileItem.Name Like "EAN*notforprint.pdf" Then<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'MsgBox FileItem.Name<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cells(r, 1).Formula = FileItem.Name<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Cells(r, 2).Formula = FileItem.Path<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cells(r, 2).Formula = FileItem.Size<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Cells(r, 4).Formula = FileItem.DateCreated<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Cells(r, 5).Formula = FileItem.DateLastModified<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r = r + 1<br>&nbsp;&nbsp;&nbsp;&nbsp;'ElseIf FileItem.Name &lt;&gt; "EAN*notforprint2.pdf" Then<br>&nbsp;&nbsp;&nbsp;&nbsp;Else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Range("A2").Interior.Color = vbRed<br>&nbsp;&nbsp;&nbsp;&nbsp;End If<br>&nbsp;&nbsp;&nbsp;&nbsp;X = SourceFolder.Path<br>&nbsp;&nbsp;Next FileItem<br>...<br>- Лист 1<br>Sub CommandButton1_Click()<br>&nbsp;&nbsp;...<br>&nbsp;&nbsp;'ActiveWorkbook.Sheets.Add.Name = "PARAM"<br>&nbsp;&nbsp;'ActiveWorkbook.Sheets.Add After:=ActiveWorkbook.Worksheets(ActiveWorkbook.Worksheets.Count)<br>&nbsp;&nbsp;ActiveWorkbook.Sheets.Add(After:=ActiveWorkbook.Worksheets(ActiveWorkbook.Worksheets.Count)).Name = "PARAM"<br>&nbsp;&nbsp;With Sheets("PARAM").Range("A1:D1")<br>&nbsp;&nbsp;&nbsp;&nbsp;.Font.Bold = True<br>&nbsp;&nbsp;&nbsp;&nbsp;.Font.Size = 12<br>&nbsp;&nbsp;End With<br>&nbsp;&nbsp;Sheets("PARAM").Range("A1").Value = "system"<br>&nbsp;&nbsp;Sheets("PARAM").Range("B1").Value = "user"<br>&nbsp;&nbsp;Sheets("PARAM").Range("C1").Value = "model"<br>&nbsp;&nbsp;Sheets("PARAM").Range("D1").Value = "API_KEY"<br>End Sub<br>...<br><strong>Source:</strong><br># https://support.microsoft.com/ru-ru/office/%D0%BD%D0%B0%D0%B7%D0%BD%D0%B0%D1%87%D0%B5%D0%BD%D0%B8%D0%B5-%D0%BC%D0%B0%D0%BA%D1%80%D0%BE%D1%81%D0%B0-%D0%BA%D0%BD%D0%BE%D0%BF%D0%BA%D0%B5-%D1%84%D0%BE%D1%80%D0%BC%D0%B0-%D0%B8%D0%BB%D0%B8-%D0%BA%D0%BD%D0%BE%D0%BF%D0%BA%D0%B5-%D1%8D%D0%BB%D0%B5%D0%BC%D0%B5%D0%BD%D1%82-%D1%83%D0%BF%D1%80%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F-d58edd7d-cb04-4964-bead-9c72c843a283 - Добавить командную кнопку (элемент ActiveX).<br># https://excelvba.ru/code/GetFileOrFolderPath?ysclid=m1yeem32al851955275 - Вывод диалоговых окон выбора файла и папки средствами VBA (выбрать файл или папку).<br># https://www.planetaexcel.ru/techniques/3/45/ - Способ 2. Готовый макрос для ленивых.<br># https://vremya-ne-zhdet.ru/vba-excel/tsvet-yacheyki-zalivka-fon/?ysclid=m1zynai2ah725271390 - Заливка ячейки цветом в VBA Excel.<br># https://learn.microsoft.com/ru-ru/office/vba/api/excel.sheets.add - Пример.<br># https://vremya-ne-zhdet.ru/vba-excel/rabochiy-list-sozdaniye-kopirovaniye-udaleniye/?ysclid=m25gff1p5c565317341 - Примеры создания листов.<br># https://dzen.ru/a/Y3pim_-6nCuOxj9k?ysclid=m25h1dcl3j61592152 - Вставить лист после другого листа.<br># https://www.cyberforum.ru/vba/thread1472349.html?ysclid=m28fdjxpam550866220 - Создание кнопки на листе программно.<br><strong>Task:</strong><br>Добавить все БС IO в шаблон инструмента Nokia.<br>Подключиться к базе.<br># Разработка макросов в VBA.<br><strong>Decision:</strong><br>- Visual Basic - Tools - References - +Microsoft ActiveX Data Objects 6.1 Library - ok<br>Private Sub ConnectionDB()<br>&nbsp;&nbsp;Dim oConn As Object<br>&nbsp;&nbsp;Set oConn = New ADODB.Connection&nbsp;&nbsp;<br>&nbsp;&nbsp;oConn.Open "DRIVER={MySQL ODBC 8.0 Unicode Driver};Server=tipwindows;Database=tbase;User=tuser;Password=tpassword;PORT:3306;Option=3"<br>&nbsp;&nbsp;If oConn.State = adStateOpen Then<br>&nbsp;&nbsp;&nbsp;&nbsp;MsgBox "Connected! =)"<br>&nbsp;&nbsp;End If<br>&nbsp;&nbsp;Dim cmd As ADODB.Command  'переменная в которой будет запрос<br>&nbsp;&nbsp;Set cmd = New ADODB.Command&nbsp;&nbsp;<br>&nbsp;&nbsp;Dim rec As ADODB.Recordset 'переменная в которой будет результат запроса<br>&nbsp;&nbsp;Set rec = New ADODB.Recordset&nbsp;&nbsp;<br>&nbsp;&nbsp;Set cmd.ActiveConnection = oConn<br>&nbsp;&nbsp;cmd.CommandText = "SELECT * FROM bss_2g_nokia" 'собственно, запрос<br>&nbsp;&nbsp;cmd.CommandType = adCmdText<br>&nbsp;&nbsp;cmd.Execute&nbsp;&nbsp;<br>&nbsp;&nbsp;Set rec.ActiveConnection = oConn<br>&nbsp;&nbsp;rec.Open cmd&nbsp;&nbsp;<br>&nbsp;&nbsp;oConn.Close  <br>End Sub<br><strong>Task:</strong><br>Подключиться к базе и выгрузить данные в таблицу.<br># Разработка макросов в VBA.<br><strong>Decision:</strong><br>Sub connect()<br>&nbsp;&nbsp;Dim Password As String<br>&nbsp;&nbsp;Dim SQLStr As String<br>&nbsp;&nbsp;'OMIT Dim Cn statement<br>&nbsp;&nbsp;Dim Server_Name As String<br>&nbsp;&nbsp;Dim User_ID As String<br>&nbsp;&nbsp;Dim Database_Name As String<br>&nbsp;&nbsp;'OMIT Dim rs statement<br><br>&nbsp;&nbsp;Set rs = CreateObject("ADODB.Recordset") 'EBGen-Daily<br>&nbsp;&nbsp;Server_Name = Range("b1").Value<br>&nbsp;&nbsp;Database_Name = Range("b2").Value ' Name of database<br>&nbsp;&nbsp;User_ID = Range("b3").Value 'id user or username<br>&nbsp;&nbsp;Password = Range("b4").Value 'Password<br><br>&nbsp;&nbsp;SQLStr = "SELECT * FROM bss_2g_nokia"<br><br>&nbsp;&nbsp;Set cn = CreateObject("ADODB.Connection") 'NEW STATEMENT<br>&nbsp;&nbsp;'cn.Open "DRIVER={MySQL ODBC 8.0 Unicode Driver};Server=tipWindows;Database=tbase;User=tuser;Password=tpassword;PORT:3306;Option=3"<br>&nbsp;&nbsp;cn.Open "Driver={MySQL ODBC 8.0 Unicode Driver};Server=" & _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Server_Name & ";Database=" & Database_Name & _<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";Uid=" & User_ID & ";Pwd=" & Password & ";"<br><br>&nbsp;&nbsp;'If cn.State = adStateOpen Then<br>&nbsp;&nbsp;'&nbsp;&nbsp;MsgBox "Connected! =)"<br>&nbsp;&nbsp;'End If<br><br>&nbsp;&nbsp;rs.Open SQLStr, cn, adOpenStatic<br><br>&nbsp;&nbsp;Dim myArray()<br><br>&nbsp;&nbsp;myArray = rs.GetRows()<br><br>&nbsp;&nbsp;kolumner = UBound(myArray, 1)<br>&nbsp;&nbsp;rader = UBound(myArray, 2)<br><br>&nbsp;&nbsp;For K = 0 To kolumner ' Using For loop data are displayed<br>&nbsp;&nbsp;&nbsp;&nbsp;Range("a5").Offset(0, K).Value = rs.Fields(K).Name<br>&nbsp;&nbsp;&nbsp;&nbsp;For R = 0 To rader<br>&nbsp;&nbsp;&nbsp;&nbsp;   Range("A5").Offset(R + 1, K).Value = myArray(K, R)<br>&nbsp;&nbsp;&nbsp;&nbsp;Next<br>&nbsp;&nbsp;Next<br><br>&nbsp;&nbsp;rs.Close<br>&nbsp;&nbsp;Set rs = Nothing<br>&nbsp;&nbsp;cn.Close<br>&nbsp;&nbsp;Set cn = Nothing<br>End Sub<br><strong>Source:</strong><br># https://www.vbastudio.ru/Book/9/9.4.html - Подключение к таблице на листе Excel.<br># https://training-course-material.com/training/ADO_Database_Connection - Подключение к базе данных ADO.<br># https://www.planetaexcel.ru/forum/?PAGE_NAME=read&FID=1&TID=119927&TITLE_SEO=119927-vba-dannye-iz-mysql-v-peremennye - VBA данные из MySQL в переменные.<br># https://stackoverflow.com/questions/13558921/how-can-vba-connect-to-mysql-database-in-excel - How can VBA connect to MySQL database in Excel?</p>
